<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/app-storage/app-localstorage/app-localstorage-document.html">

<link rel="import" href="./sh-navigation.html">
<link rel="import" href="./sh-panel.html">
<link rel="import" href="./sh-leaderboard.html">
<link rel="import" href="./sh-profile.html">
<link rel="import" href="./sh-capture-photo.html">
<link rel="import" href="./sh-party-island.html">

<dom-module id="sh-main">
  <template>
    <style>
      @import url('https://fonts.googleapis.com/css?family=Montserrat:400,600');
      /* 
        Loader indicator 
      */
      :host {
        display: block;
        /* flex-direction: column; */
        /* height: 100vh;
        overflow: hidden; */
        /* position: relative; */
        font-family: 'Montserrat', sans-serif;
        font-weight: 400;
        --plays-tate: paused;
      }

      .panel {
        display: block;
        visibility: hidden;
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 800;
        transition: visibility 0.5s linear,
        transform 0.5s ease-in-out;
        transform: translate3d(0, 100vh, 0);
        will-change: transform, visibility;
        overflow: scroll;
        overscroll-behavior: contain;
        -webkit-overflow-scrolling: touch;
      }

      .panel.open {
        visibility: visible;
        transition: visibility 0s linear,
        transform 0.5s ease-in-out;
        transform: translate3d(0, 0, 0);
      }

      .map {
        background-image: url(/images/game-screen-100.png);
        background-repeat: no-repeat;
        background-position: 0 0;
        background-size: auto 100%;
        display: grid;
        grid-template-columns: repeat(10, 10vw);
        grid-template-rows: repeat(31, 10vw);
      }

      /* Retina-specific */

      @media (-webkit-min-device-pixel-ratio: 2),
      (min-resolution: 192dpi) {
        .map {
          background-image: url(/images/game-screen-200.png);
        }
      }

      .party-island {
        grid-column: 9;
        grid-row: 7 / 11;
        background-color: rgba(0, 0, 0, .5);
      }

      .stage {
        background-color: #24ce00;
        color: white;
        border: 2px solid #20a300;
        box-shadow: 0 0 4px white;
        border-radius: 50%;
        position: relative;
      }

      .stage--done {
        background-color: #ffbf00;
        border: 2px solid #dd9e00;
      }

      /*
      stage 1 = 5% 
      stage 2 = 11
      stage 3 = 14
      stage 4 = 20
      stage 5 = 29
      stage 6 = 34
      stage 7 = 38
      stage 8 = 50
      */

      .stage--one {
        grid-column: 2;
        grid-row: 7;
      }

      .stage--two {
        grid-column: 4;
        grid-row: 9;
      }

      .stage--three {
        grid-column: 5;
        grid-row: 11;
      }

      .stage--four {
        grid-column: 2;
        grid-row: 14;
      }

      .stage--five {
        grid-column: 8;
        grid-row: 17;
      }

      .stage--six {
        grid-column: 8;
        grid-row: 22;
      }

      .stage--seven {
        grid-column: 6;
        grid-row: 24;
      }

      .stage--eight {
        grid-column: 4 / 7;
        grid-row: 29 / 31;
        background: none;
        border: none;
        box-shadow: none;
      }

      .stage__action {
        border: 0;
        background-color: transparent;
        position: absolute;
        width: calc(100% + 20px);
        color: white;
        font-weight: 600;
        font-size: 1rem;
        top: -10px;
        left: -10px;
        bottom: -10px;
        z-index: 10;
        display: block;
      }

      .castle {
        background-image: url(/images/castle.svg);
        background-repeat: no-repeat;
        background-size: 94%;
        background-position-y: 7vw;
        grid-column: 3 / 8;
        grid-row: 27 / 32;
        z-index: 400;
      }

      .user {
        position: relative;
        z-index: 200;
        height: 10vw;
        width: 10vw;
        grid-column: 4;
        grid-row: 4;
        animation: path 10s linear infinite alternate;
        animation-play-state: var(--plays-tate);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-direction: column;
        pointer-events: none;
      }

      .user__picture {
        display: block;
        width: calc(8vw - 4px);
        height: calc(8vw - 4px);
        border-radius: 50%;
        animation: hover 1.4s ease infinite alternate;
        flex: 0 0 calc(8vw - 4px);
        border: 1px solid rgba(0, 0, 0, .2);
        background-color: white;
        padding: 2px;
      }

      .user__shadow {
        width: 6vw;
        height: 2vw;
        background-color: rgba(0, 0, 0, .3);
        flex: 0 0 2vw;
        border-radius: 50%;
        animation: shadow 1.4s ease infinite alternate;
      }

      @keyframes hover {
        100% {
          transform: translateY(-20%);
        }
      }

      @keyframes shadow {
        0% {
          transform: scale3d(1, 1, 1);
        }
        100% {
          transform: scale3d(.8, .8, 1);
          filter: opacity(30%)
        }
      }

      @keyframes path {
        0 {}

        6% {
          transform: translate3d(0, 300%, 0);
        }
        12% {
          transform: translate3d(-300%, 300%, 0);
        }
        16% {
          transform: translate3d(-300%, 500%, 0);
        }
        24% {
          transform: translate3d(100%, 500%, 0);
        }
        30% {
          transform: translate3d(100%, 800%, 0);
        }
        36% {
          transform: translate3d(-200%, 800%, 0);
        }
        46% {
          transform: translate3d(-200%, 1300%, 0);
        }
        58% {
          transform: translate3d(400%, 1300%, 0);
        }
        68% {
          transform: translate3d(400%, 1800%, 0);
        }
        72% {
          transform: translate3d(200%, 1800%, 0);
        }
        88% {
          transform: translate3d(200%, 2600%, 0);
        }
        92% {
          transform: translate3d(400%, 2600%, 0);
          z-index: 0;
        }

        94% {
          transform: translate3d(400%, 2700%, 0);
          z-index: 700;
        }

        100% {
          transform: translate3d(100%, 2700%, 0);
          z-index: 700;
        }
      }
    </style>

    <app-localstorage-document key="photos" data="{{photos}}"></app-localstorage-document>

    <sh-navigation></sh-navigation>

    <div class="map">

      <div class="user">
        <img src="/images/andres.jpg" alt="avatar of andres galante" class="user__picture">
        <div class="user__shadow"></div>
      </div>
      <div class="castle"></div>

      <button class="party-island" on-click="openPartyIsland">
        Party! ðŸŽ‰
      </button>

      <div class="stage stage--one stage--done">
        <button class="stage__action">1</button>
      </div>
      <div class="stage stage--two stage--done">
        <button class="stage__action">2</button>
      </div>
      <div class="stage stage--three">
        <button class="stage__action">3</button>
      </div>
      <div class="stage stage--four">
        <button class="stage__action">4</button>
      </div>
      <div class="stage stage--five">
        <button class="stage__action">5</button>
      </div>
      <div class="stage stage--six">
        <button class="stage__action">6</button>
      </div>
      <div class="stage stage--seven">
        <button class="stage__action">7</button>
      </div>
      <div class="stage stage--eight">
        <button class="stage__action"></button>
      </div>

    </div>

    <sh-panel class$="panel [[partyIslandOpen]]" name="party-island">
      <sh-party-island tasks="{{tasks}}"></sh-party-island>
    </sh-panel>

    <button on-click="capturePhoto">Capture Photo</button>
    <iron-pages class$="panel [[panelOpen]]" selected="[[navItem]]" attr-for-selected="name">
      <sh-panel name="profile">
        <sh-profile photos="{{photos}}"></sh-profile>
      </sh-panel>
      <sh-panel name="leaderboard">
        <sh-leaderboard></sh-leaderboard>
      </sh-panel>
      <sh-panel name="capture-photo">
        <sh-capture-photo photos="{{photos}}" task="{{selectedTask}}"></sh-capture-photo>
      </sh-panel>
    </iron-pages>
  </template>

  <script>
    class ShMain extends Polymer.Element {
      static get is() { return 'sh-main'; }
      static get properties() {
        return {
          navItem: {
            type: String,
            value: 'leaderboard'
          },
          panelOpen: {
            type: String,
            value: ''
          },
          partyIslandOpen: {
            type: String,
            value: ''
          },
          tasks: {
            type: Array,
            value: [
              { description: 'Take a picture of the Red Hat logo' },
              { description: 'Take a picture of a person smiling' },
              { description: 'Take a picture of Tux' }
            ]
          },
          selectedTask: {
            type: Object
          }
        };
      }

      constructor() {
        super();
        this.addEventListener('nav-item-selected', this.navItemSelectedHandler);
        this.addEventListener('nav-item-close', this.closeNav);
      }

      navItemSelectedHandler(event) {
        this.navItem = event.detail.navItem;

        if (event.detail.selectedTaskIndex !== undefined) {
          this.selectedTask = this.get(['tasks', event.detail.selectedTaskIndex]);
        }

        this.panelOpen = 'open';
      }

      closeNav(event) {
        if (event.detail.panel === 'party-island') {
          this.partyIslandOpen = '';
          return;
        }

        this.panelOpen = '';
      }

      fireNavItemSelectedEvent(navItem) {
        const customEvent = new CustomEvent('nav-item-selected', {
          detail: {
            navItem: navItem
          }
        });

        this.dispatchEvent(customEvent);
      }

      capturePhoto() {
        this.fireNavItemSelectedEvent('capture-photo');
      }

      openPartyIsland() {
        this.partyIslandOpen = 'open';
      }
    }

    window.customElements.define(ShMain.is, ShMain);
  </script>
</dom-module>
